---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: Experiment Title
subtitle: Web address for GitHub repository
author: Your Name
abstract: "Experimental overview. This section should be no longer than 250 words."
fontsize: 12pt
mainfont: Times New Roman
editor_options: 
  chunk_output_type: console
---

<Information in these brackets are used for annotating the RMarkdown file. They will not appear in the final version of the PDF document>

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

<Setup the global options for the R chunks in your document>

<Note: set up autoreferencing for figures and tables in your document>

```{r setup, include=FALSE}
#Setting the working directory
setwd("C:/Users/jerik/OneDrive/Documents/Spring 2019 Semenster/Environmental Data Analytics/EDA_R_Work/EDA/Project/EDA Final Project")
#Confirming that it is the correct working directory
getwd()

# Load your packages
library(forecast)
library(tseries)
library(Kendall)
library(dplyr)
library(uroot)
library(tidyverse)
library(trend)
library(lubridate)
library(grid)
library(knitr)
library(summarytools)

# Set your ggplot theme
NK.theme <- theme_light(base_size = 12) +
  theme(panel.grid.major =element_line(linetype = "solid", colour = "grey93"),panel.grid.minor = element_line(linetype = "dotted", colour = "grey90"), text=element_text(size = 13, color = "black", face = "bold"),axis.text = element_text(color = "grey40"), legend.position = "right",legend.text = element_text(color = "grey40"))
#setting it as my default theme
theme_set(NK.theme)
```


# Research Question and Rationale

> Electricity generation in the United States is dominated by fossil fuel-based technologies. According to the U.S. Energy Information Administration, In 2018 63.5 % (EIA, 2018) of the electricity generated in the country was from fossil fuel based sources such as coal and natural gas. The combustion of fossil fuels, necessary for electricity generation, is the main cause of human-driven emission of greenhouse gases (GHGs) (Quadrelli & Peterson, 2007) particularly carbon dioxide. The alternative use of renewable energy provides an opportunity to decarbonize the electricity sector and mitigate the negative emission impacts. In the US there appears to be a significant shift in electricity generation from fossil fuels to renewable energy in the last decade. EIA estimates that the adoption of renewable energy to generate electricity has doubled from 2008 to 2019 to account for about 17% (EIA, 2018) of the total electricity generation mix. 

> This paper will aim to:

1. Research the trend in national level electricity generation from renewable energy sources disaggregated by the main renewable sources contributing to the growth in total proportion of renewable energy generation.

2. Investigate the specific trends in wind energy adoption in Kansas and solar energy in California to identify any policy change implications on renewable energy adoption. 

> Kansas state was selected for the second component of the analysis because wind energy contributes the largest proportion of the state's overall electricity generation (36% as of 2018) compared to other states. Kansas was also selected because in 2009 it adopted a mandatory renewable energy policy known as a Renewable Portfolio Standard (RPS) mandating that the state should generate 20% of its electricity from renewable sources by 2025. In 2015, Kansas repealed this policy and changing the renewable energy goal from mandatory to voluntary (Barbose, 2018). California was selected because solar energy contributes the largest proportion of the state's overall electricity generation (14% as of 2018) compared to other states. California also adopted an RPS policy in 2002. However, unlike Kansas, it is much more ambitious, it mandates that the state will generate 60% of its electricity from renewable sources by 2030 (Barbose, 2018). Also, unlike Kansas, California has made several revisions to its renewable energy policy to strengthen it including in 2006,2007,2011,2015 and 2018 (Barbose, 2018).  

> The dataset that shall be used for this analysis is the Energy Information Administration (EIA) data on Monthly total electric power generation data by State and energy source from 2001 - 2018 available [here](https://www.eia.gov/electricity/data/state/generation_monthly.xlsx)


\newpage

# Dataset Information

> The dataset used for this analysis was Energy Information Administration (EIA) data on Monthly total electric power generation in Megawatt Hours (MWh) by State and energy source from 2001 - 2018 obtained from their site. The data contained excel sheets with monthly totals of electricity generation by type of power producer and type of energy source in 51 states in the US including national total from January 2001 to January 2019. The dataset included 14 tyoes of energy sources and 6 types of energy producers:

 + Combined Heat and Power, Commercial Power
 + Combined Heat and Power, Electric Power
 + Combined Heat and Power, Industrial Power 
 + Electric Generators, Electric Utilities
 + Electric Generators, Independent Power Producers
 + Total Electric Power Industry

> The U.S. Renewable Portfolio Standards 2018 Annual Status Report written by the Lawrence Berkeley National Laboratory was also used as the reerence source to obtain information on the years states, particularly Kansas and California, made major revisions to their RPS policies.

```{r, echo=FALSE}
#importing the raw data
data.2001_2002 <- read.csv("./Data/Raw/2001_2002_data.csv")
data.2003_2004 <- read.csv("./Data/Raw/2003_2004_data.csv")
data.2005_2007 <- read.csv("./Data/Raw/2005_2007_data.csv")
data.2008_2009 <- read.csv("./Data/Raw/2008_2009_data.csv")
data.2010_2011 <- read.csv("./Data/Raw/2010_2011_data.csv")
data.2012 <- read.csv("./Data/Raw/2012_data.csv")
data.2013 <- read.csv("./Data/Raw/2013_data.csv")
data.2014 <- read.csv("./Data/Raw/2014_data.csv")
data.2015 <- read.csv("./Data/Raw/2015_data.csv")
data.2016 <- read.csv("./Data/Raw/2016_data.csv")
data.2017 <- read.csv("./Data/Raw/2017_data.csv")
data.2018 <- read.csv("./Data/Raw/2018_data.csv")
data.2019 <- read.csv("./Data/Raw/2019_data.csv")

#wrangling data to one data set by state
#combining dataset
EIA.data.2001_2019 <- rbind(data.2001_2002,data.2003_2004,data.2005_2007,data.2008_2009,data.2010_2011,data.2012,data.2013,data.2014,data.2015,data.2016,data.2017,data.2018,data.2019)
```


```{r, echo=FALSE}
#Generating a table that summarizes the raw data structure
Str.EIA.data <- summary(EIA.data.2001_2019)
kable(Str.EIA.data)
```

\newpage

# Exploratory Data Analysis and Wrangling

##Initial data exploration

> Explored the raw data set to determine the general structure of the dataset and variables within it as shown in the code below. This exploration also included displaying the first 10 rows and last 10 rows of the dataset.

```{r, echo=TRUE}
#Summary code
#Structure of the dataset
str(EIA.data.2001_2019)

#Collumn names of the variables
colnames(EIA.data.2001_2019)

#First 10 rows of the dataset
kable(head(EIA.data.2001_2019, 10), caption = "First 10 rows of the raw dataset, EIA.data.2001_2019")
#Last 10 rows of the dataset
kable(tail(EIA.data.2001_2019, 10), caption = "Last 10 rows of the raw dataset, EIA.data.2001_2019")
```

> Further explored of the raw dataset was carried out to determine the different factor types in the variables 'TYPE.OF.PRODUCER' and 'ENERGY.SOURCE' and the number of unique factors in the STATE variable.

```{r, echo=TRUE}
#Showing the different factors in TYPE.OF.PRODUCER variable
kable(freq(EIA.data.2001_2019$TYPE.OF.PRODUCER), caption = "Factor types of Type of Producer Variable")

#Showing the different factors in ENERGY.SOURCE variable
kable(freq(EIA.data.2001_2019$ENERGY.SOURCE), caption = "Factor types of Energy Source Variable")

#Showing the number of unique state types in the STATE variable
unique(EIA.data.2001_2019$STATE)
length(unique(EIA.data.2001_2019$STATE))
```

> The above data exploration revealed the following factors of interest, *Total Electric Power Industry* in the variable **Type of Producer** and *US-TOTAL* and *US-Total* in the **State** variable. Further data exploration was carried out to determine if the *Total Electric Power Industry* factor represents electricity generation values for the summation of all other types of producers and the difference between factor *US-TOTAL* and *US-Total* relevant to total electricity generation in all states (at the national level).

### Initial data wrangling to determine variation on Producer Types and State factors

```{r, echo=TRUE}
#Creating a dataset of elec generation sum for of all types of producers and comparing it generation of producer type - total electric power industry  
EIA.data.producers <- EIA.data.2001_2019 %>%
  summarise(`First 5 producer types (GWh)` = sum(as.numeric(GENERATION..Megawatthours.[TYPE.OF.PRODUCER!="Total Electric Power Industry"]))/1000,
            `Total Electric Power Industry (GWh)` = sum(as.numeric(GENERATION..Megawatthours.[TYPE.OF.PRODUCER=="Total Electric Power Industry"]))/1000)

kable(EIA.data.producers, caption = "Total electricity generation by producer types.")
```

> The total electricity generation of all producer types except 'Total Electric Power Industry' was equal to that of 'Total Electric Power Industry'

```{r}
#Creating datasets with and without Us-Total and US-TOTAL factors
EIA.Data.only_states <- EIA.data.2001_2019 %>%
  filter(TYPE.OF.PRODUCER=="Total Electric Power Industry") %>%
  filter(ENERGY.SOURCE=="Total") %>%
  filter(STATE!= "US-TOTAL" & STATE!= "US-Total") %>%
  mutate(Date = make_date(YEAR,MONTH))

EIA.Data.only_states.sum <- EIA.Data.only_states %>%
  summarise(`Total Elec Gen for States (GWh)` = sum(as.numeric(GENERATION..Megawatthours.))/1000)

EIA.Data.US <- EIA.data.2001_2019 %>%
  filter(TYPE.OF.PRODUCER=="Total Electric Power Industry") %>%
  filter(ENERGY.SOURCE=="Total") %>%
  filter(STATE== "US-TOTAL" | STATE== "US-Total") %>%
  mutate(Date = make_date(YEAR,MONTH))

EIA.Data.US.sum <- EIA.Data.US %>%
  summarise(`Total Elec Gen US-TOTAL  (GWh)` = sum(as.numeric(GENERATION..Megawatthours.[STATE=="US-TOTAL"]))/1000,
            `Total Elec Gen US-Total  (GWh)` = sum(as.numeric(GENERATION..Megawatthours.[STATE=="US-Total"]))/1000,
            `Total Elec Gen US-Both  (GWh)` = sum(as.numeric(GENERATION..Megawatthours.))/1000)

#Table comparison of electricity generation summation of both datasets
EIA.Data.States.US.sum <- cbind(EIA.Data.only_states.sum,EIA.Data.US.sum)
kable(EIA.Data.States.US.sum, caption = "Summation of Total Electricity generation for all STATES and both US factors")
```

**Plot of variation in electricity generation at the US-TOTAL and US-Total factor level**
```{r, echo=false}
Plot1 <- 
  ggplot(EIA.Data.US,aes(x=as.Date(Date), y=(GENERATION..Megawatthours./1000), color = STATE)) +
  geom_line() +
  ylab("Electricity generation (GWh)") +
  xlab("Date (Year)") +
  labs(color = "State",title = "National Electricity generation") +
  scale_x_date(date_breaks = "1 year", date_labels = "%m/%Y") +
  theme(axis.text.x = element_text(angle = 45,  hjust = 1)) +
  scale_colour_manual("National generation",
                      values = c("US-TOTAL"="brown3", 
                                 "US-Total"="darkorange3"))
```

```{r, echo=FALSE,fig.height = 5, fig.width = 5, fig.cap="National electricity generation"}
print(Plot1)
```


> There was a small variation between the total states electricity generation and the US summation as shown in the table XX above. A dataset using only the states data was therefore used for the state level analysis and a dataset including summation of generation across states was used for the national level analysis. Date at the US-TOTAL and US-Total factor level were therefore not used because of the slight discrepacy with aggregated state values.  

**Plot of variation in electricity generation at the State level**
```{r, echo=false}
Plot2 <- 
  ggplot(data = subset(EIA.Data.only_states,(Date == "2019-01-01")),aes(x=STATE, y=(GENERATION..Megawatthours./1000), fill = STATE)) +
  geom_col() +
  ylab("Electricity generation (GWh)") +
  xlab("State") +
  labs(title = "Total electricity generation in Jan 2019 per state") +
  theme(axis.text.x = element_text(angle = 90,  hjust = 1, vjust = 0.4), legend.position="none")
```

```{r, echo=FALSE,fig.height = 5, fig.width = 5, fig.cap="Total electricity generation in Jan 2019 per state"}
print(Plot2)
```


##Data wrangling to create the main datasets for national and state level

###Creation of first dataset - EIA.data.by_state

> To obtain the first dataset for data analysis, EIA.data.by_state, the EIA.data.2001_2019 raw dataset was wrangled as shown in the code below to include only the Total Electric Power Industry which is a summation of all producer codes as shown in the table XX above and to remove US national totals. The data wrangling was also done to spread data according to MWh generation of each energy source and to combine the year and month collumn into one date variable. The final dataset, EIA.data.by_state, includes the following variables of interest: Date, State, Geothermal, Hydro,Other.Biomass, Solar, Wind, Wood.products, Renewable.total, Coal, Nat.Gas, Petroleum, Total 

```{r, echo=TRUE}
EIA.data.by_state <- EIA.data.2001_2019 %>%
  filter(TYPE.OF.PRODUCER=="Total Electric Power Industry") %>%
  filter(STATE!= "US-TOTAL" & STATE!= "US-Total") %>%
  spread(ENERGY.SOURCE,GENERATION..Megawatthours.) %>%
  mutate(Geothermal =ifelse(is.na(Geothermal),0,Geothermal)) %>%
  mutate(Hydro = ifelse(is.na(`Hydroelectric Conventional`),0,`Hydroelectric Conventional`)) %>%
  mutate(Other.Biomass = ifelse(is.na(`Other Biomass`),0,`Other Biomass`)) %>%
  mutate(Solar = ifelse(is.na(`Solar Thermal and Photovoltaic`),0,`Solar Thermal and Photovoltaic`)) %>%
  mutate(Wind = ifelse(is.na(Wind),0,Wind)) %>%
  mutate(Wood.products = ifelse(is.na(`Wood and Wood Derived Fuels`),0,`Wood and Wood Derived Fuels`)) %>%
  mutate(Renewable.total = Geothermal+Hydro+Other.Biomass+Solar+Wind+Wood.products) %>%
  mutate(Coal = ifelse(is.na(Coal),0,Coal)) %>%
  mutate(Nat.Gas = ifelse(is.na(`Natural Gas`),0,`Natural Gas`)) %>%
  mutate(Petroleum = ifelse(is.na(Petroleum),0,Petroleum)) %>%
  mutate(Nuclear = ifelse(is.na(Nuclear),0,Nuclear)) %>%
  mutate(Date = make_date(YEAR,MONTH)) %>%
  select(Date, STATE, Geothermal,Hydro,Other.Biomass,Solar,Wind, Wood.products,Coal,Nat.Gas,Petroleum,Nuclear,Renewable.total,Total)
```

###Creation of second dataset - EIA.data.national

> A second analysis dataset was created to represent national electricity generation across various energy sources by summing state level values as shown in the wrangling code below.

```{r, echo=TRUE}
EIA.data.national <- EIA.data.by_state %>%
  group_by(Date) %>%
  summarise(National.Geothermal = sum(Geothermal),
            National.Hydro = sum(Hydro),
            National.Other.Biomass = sum(Other.Biomass),
            National.Solar = sum(Solar),
            National.Wind = sum(Wind),
            National.wood.products = sum(Wood.products),
            National.Coal = sum(Coal),
            National.Nat.Gas = sum(Nat.Gas),
            National.Petroleum = sum(Petroleum),
            National.Nuclear =sum(Nuclear),
            National.Renewable.total = sum(Renewable.total),
            National.Total = sum(Total))
```

###Data exploration of created datasets

> Table below shows the summary statistics for the electricity generation from all the selected energy sources including total renewable energy (Renewable.total variable) and all the energy sources (Total variable).

```{r, echo=FALSE}
#Summary statistics for total electricity generation in MWh for all states
Elec.Gen.stats <- summarytools::descr(EIA.data.by_state[,3:14], stats = c("N.Valid","Pct.Valid","mean", "sd", "min", "med", "max", "iqr"), transpose = TRUE)

kable(Elec.Gen.stats, caption = "Summary statistics for electricity generation (MWh) by energy source for all states")
```

###Data visualization of created datasets

**Plot of national level electricity generation by main energy sources across time**
```{r, echo=FALSE}
Plot3 <-
  ggplot(EIA.data.national,aes(x=as.Date(Date))) +
  geom_line(aes(y = National.Geothermal/1000, color ="Geothermal")) +
  geom_line(aes(y = National.Hydro/1000, color ="Hydroelectric")) +
  geom_line(aes(y = National.Solar/1000, color ="Solar")) +
  geom_line(aes(y = National.Wind/1000, color ="Wind")) +
  geom_line(aes(y = National.Coal/1000, color ="Coal")) +
  geom_line(aes(y = National.Nat.Gas/1000, color ="Natural Gas")) +
  geom_line(aes(y = National.Petroleum/1000, color ="Petroleum")) +
  geom_line(aes(y = National.Nuclear/1000, color ="Nuclear")) +
  ylab("Generation (MWh)") +
  xlab("Date (Month/Year)") +
  labs(title = "National electricity generation by energy source") +
  scale_x_date(date_breaks = "1 year", date_labels = "%m/%Y") +
  theme(axis.text.x = element_text(angle = 45,  hjust = 1)) +
  scale_colour_manual("Energy sources",
                      values = c("Geothermal"="coral3", 
                                 "Hydroelectric"="blue4",
                                 "Solar"="yellow3",
                                 "Wind"="springgreen4", 
                                 "Coal"="gray20",
                                 "Natural Gas"="orangered3",
                                 "Petroleum"="sienna4",
                                 "Nuclear"="plum4"))
```

```{r, echo=FALSE,fig.height = 5, fig.width = 8, fig.cap="National electricity generation by energy source"}
print(Plot3)
```

\newpage

# Analysis
##A. National level trend analysis
###Visualization of trends of major renewable and non-renewable energy sources

> Based on the data exploration and specifically figure XX(PLOT3), The major renewable energy sources appear to be Hydroelectric power, wind energy and solar energy. The major non renewable energy sources are coal energy, natural gas energy and nuclear energy.

```{r, echo=FALSE}
##Renewable energy plot
EIA.Data.plot4 <- EIA.data.national %>%
  gather("Energy Sources", "Electricity generation(MWh)", c(3,5,6,12)) %>%
  select(Date, `Energy Sources`, `Electricity generation(MWh)`)

Plot4 <- 
  ggplot(EIA.Data.plot4,aes(x=as.Date(Date), y=`Electricity generation(MWh)`/1000, color =`Energy Sources`)) +
  geom_line() +
  facet_wrap(vars(`Energy Sources`), nrow = 3, scales = "free_y") +
  theme(strip.background = element_rect(fill = "black"), strip.text = element_text(color = "white")) +
  ylab("Electricity generation (GWh)") +
  xlab("Date (Year)") +
  labs(title = "Electricity generation by major renewable sources") +
  scale_x_date(date_breaks = "2 year", date_labels = "%Y") +
  theme(axis.text.x = element_text(angle = 45,  hjust = 1), legend.position = "none") +
  scale_colour_manual("Energy sources",
                      values = c("National.Hydro"="blue4",
                                 "National.Solar"="yellow3",
                                 "National.Wind"="springgreen4", 
                                 "National.Renewable.total"="yellowgreen"))
```

```{r, echo=FALSE,fig.height = 5, fig.width = 8, fig.cap="Electricity generation by major renewable sources"}
print(Plot4)
```

> Based on the series of the major renewable energy sources, hydroelectric energy does not appear to have any incleasing trend therefore it is unlikely that it has contributed to the visibly increasing growth in total renewable energy generation at the national level. Solar and wind energy however appear to have a similar increasing trend. The trend analysis at the national level was therefore carried out on the solar and wind series as well as the total renewable energy series.

```{r, echo=FALSE}
##Non-renewable energy plot
EIA.Data.plot5 <- EIA.data.national %>%
  mutate(National.non.ren.total = (National.Total - National.Renewable.total)) %>%
  gather("Energy Sources", "Electricity generation(MWh)", c(8,9,11,14)) %>%
  select(Date, `Energy Sources`, `Electricity generation(MWh)`)

Plot5 <- 
  ggplot(EIA.Data.plot5,aes(x=as.Date(Date), y=`Electricity generation(MWh)`/1000, color =`Energy Sources`)) +
  geom_line() +
  facet_wrap(vars(`Energy Sources`), nrow = 2, scales = "free_y") +
  theme(strip.background = element_rect(fill = "black"), strip.text = element_text(color = "white")) +
  ylab("Electricity generation (GWh)") +
  xlab("Date (Year)") +
  labs(title = "Electricity generation by major renewable sources") +
  scale_x_date(date_breaks = "2 year", date_labels = "%Y") +
  theme(axis.text.x = element_text(angle = 45,  hjust = 1), legend.position = "none") + 
  scale_colour_manual("Energy sources",
                      values = c("National.non.ren.total"="khaki4",
                               "National.Coal"="gray20",
                                "National.Nat.Gas"="orangered3", 
                                "National.Nuclear"="plum4"))
```

```{r, echo=FALSE,fig.height = 5, fig.width = 8, fig.cap="Electricity generation by major renewable sources"}
print(Plot5)
```

> Based on the series of the major non-renewable energy sources, nuclear energy does not appear to have as significant a trend as coal and Natural gas. It is therefore unlikely that it has contributed significantly to the slight decrease in total non renewable energy generation at the national level. The trend analysis at the national level was therefore carried out on the coal and natural gas series.

###Trend analysis of major renewable and non-renewable energy series.

#### Changing to timeseries data and removing seasonality

> It was necessary to change the energy series into time series and to remove the obvious seasonality so as to be able to carry out trend analysis tests.


```{r, echo=TRUE}
#Changing series of interest into timeseries data
Nat.Solar.ts.data <- ts(EIA.data.national[,5], start = c(2001,01), end=c(2019,1),frequency = 12)
Nat.Wind.ts.data <- ts(EIA.data.national[,6], start = c(2001,01), end=c(2019,1),frequency = 12)
Nat.Renewable.ts.data <- ts(EIA.data.national[,12], start = c(2001,01), end=c(2019,1),frequency = 12)
Nat.Coal.ts.data <- ts(EIA.data.national[,8], start = c(2001,01), end=c(2019,1),frequency = 12)
Nat.Gas.ts.data <- ts(EIA.data.national[,9], start = c(2001,01), end=c(2019,1),frequency = 12)

##Removing seasonality
##Removing seasonality in solar series
Nat.Solar.decomp <- decompose(Nat.Solar.ts.data)
deseasonal_Nat.Solar <- seasadj(Nat.Solar.decomp)

##Removing seasonality in wind series
Nat.Wind.decomp <- decompose(Nat.Wind.ts.data)
deseasonal_Nat.Wind <- seasadj(Nat.Wind.decomp)

##Removing seasonality in renewable series
Nat.Renewable.decomp <- decompose(Nat.Renewable.ts.data)
deseasonal_Nat.Renewable <- seasadj(Nat.Renewable.decomp)

##Removing seasonality in coal series
Nat.Coal.decomp <- decompose(Nat.Coal.ts.data)
deseasonal_Nat.Coal <- seasadj(Nat.Coal.decomp)

##Removing seasonality in natural gas series
Nat.Gas.decomp <- decompose(Nat.Gas.ts.data)
deseasonal_Nat.Gas <- seasadj(Nat.Gas.decomp)
```

#### Carrying out ADF and Mankandal trend test
##### ADF trend tests on series

> To test for a stochastic trend in the series, and ADF trend test was carried out

```{r, echo=TRUE}
#Checking for a stochastic trend with ADF test on solar series 
adf.test(deseasonal_Nat.Solar, alternative = "stationary")

#Checking for a stochastic trend with ADF test on wind series 
adf.test(deseasonal_Nat.Wind, alternative = "stationary")

#Checking for a stochastic trend with ADF test on total renewable energy series 
adf.test(deseasonal_Nat.Renewable, alternative = "stationary")

#Checking for a stochastic trend with ADF test on coal series 
adf.test(deseasonal_Nat.Coal, alternative = "stationary")

#Checking for a stochastic trend with ADF test on natural gas series 
adf.test(deseasonal_Nat.Gas, alternative = "stationary")
```

> The null hypothesis of the ADF test is that a stochastic trend is present in the series. The test results indicate that the following series have a stochastic trend.

 + The national solar energy series (p-value = 0.9506)
 + The national wind energy series (p-value = 0.07573)
 + The national total renewable energy series (p-value = 0.08238)
 + The national coal energy series (p-value = 0.3148)
 
> The national natural gas series has a low p value (p-value = 0.01354) indicating it does not have a stochastic trend. A Man Kendall test to test for a deterministic trend in the series was therefore carried out. 

##### Mann-Kendall trend tests on natural gas series

```{r, echo=TRUE}
#Checking for a monotonic trend using the Mann Kendall Test
MannKendall(deseasonal_Nat.Gas)
```

> The null hypothesis of the  Mann-Kendall test is that there is no monotonic trend. The low p value of the test (pvalue =< 2.22e-16) indicates that we should reject the null hypothesis for the alternative that a monotonic trend is present in the natural gas series. The trend is increasing (tau = 0.817)

###Changepoint analysis of major renewable energy sourcess.
#### Changepoint analysis for solar energy series
```{r, echo=TRUE}
#analysis of first change point for solar series
pettitt.test(deseasonal_Nat.Solar)
```

> Low p-value (< 2.2e-16) indicates that there is a significant changepoint at observation 130 which coresponds to the date 2011-10-01.

```{r, echo=TRUE}
#analysis of second change point for solar series
pettitt.test(deseasonal_Nat.Solar[131:217])
```

> Low p-value (2.978e-14) indicates that there is a significant changepoint at observation 40 (170) which coresponds to the date 2015-02-01.

```{r, echo=TRUE}
#analysis of third change point for solar series
pettitt.test(deseasonal_Nat.Solar[171:217])
```

> Low p-value (2.216e-07) indicates that there is a significant changepoint at observation 24 (194) which coresponds to the date 2017-02-01.

```{r, echo=TRUE}
#analysis of fourth change point for solar series
pettitt.test(deseasonal_Nat.Solar[195:217])
```

> the high p-value (0.2886) of the test indicates that there no other significant changepoint.

**Plot of National solar changepoints**
```{r, echo=FALSE}
Plot6 <- ggplot(data = EIA.data.national, (aes(x = Date))) +
  geom_line(aes(y = (National.Solar/1000), color = "Solar")) +
  geom_line(aes(y = (National.Renewable.total/1000), color ="Renewable")) +
  geom_segment(aes(x = as.Date("2011-10-01"), y = 15000, xend = as.Date("2011-10-01"), yend = 200), arrow = arrow(length = unit(0.3, "cm")), color= "yellow3", linetype = "dashed") +geom_label(aes(label="Change point 1", x=as.Date("2011-10-01"), y = 15000) , size=3, fill= "yellow3", color = "white") +
  geom_segment(aes(x = as.Date("2015-02-01"), y = 24000, xend = as.Date("2015-02-01"), yend = 1100), arrow = arrow(length = unit(0.3, "cm")), color= "yellow3", linetype = "dashed") +geom_label(aes(label="Change point 2", x=as.Date("2015-02-01"), y = 24000) , size=3, fill= "yellow3", color = "white") +
  geom_segment(aes(x = as.Date("2017-02-01"), y = 27000, xend = as.Date("2017-02-01"), yend = 2500), arrow = arrow(length = unit(0.3, "cm")), color= "yellow3", linetype = "dashed") +geom_label(aes(label="Change point 3", x=as.Date("2017-02-01"), y = 27000) , size=3, fill= "yellow3", color = "white") +
  xlab("Date") +
  ylab("Electricity Generation (GWh)") +
  labs(title = "National Solar Electricity Generation Changepoints") +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  scale_colour_manual("Energy sources",
                      values = c("Total"="goldenrod3", 
                                 "Solar"="yellow3",
                                 "Renewable"="yellowgreen")) 
```

```{r, echo=FALSE,fig.height = 6, fig.width = 8, fig.cap="National Solar Electricity Generation Changepoints"}
print(Plot6)
```


#### Changepoint analysis for wind energy series
```{r, echo=TRUE}
#analysis of first change point for wind series
pettitt.test(deseasonal_Nat.Wind)
```

> Low p-value (< 2.2e-16) indicates that there is a significant changepoint at observation 110 which coresponds to the date 2010-02-01.

```{r, echo=TRUE}
#analysis of second change point for wind series
pettitt.test(deseasonal_Nat.Wind[111:217])
```

> Low p-value (1.8e-15) indicates that there is a significant changepoint at observation 56 (166) which coresponds to the date 2014-10-01.

```{r, echo=TRUE}
#analysis of third change point for wind series
pettitt.test(deseasonal_Nat.Wind[167:217])
```

> Low p-value (4.379e-06) indicates that there is a significant changepoint at observation 23 (189) which coresponds to the date 2016-09-01.

```{r, echo=TRUE}
#analysis of fourth change point for solar series
pettitt.test(deseasonal_Nat.Wind[190:217])
```

> the high p-value (0.09209) of the test indicates that there no other significant changepoint.

**Plot of National wind changepoints**
```{r, echo=FALSE}
Plot7 <- ggplot(data = EIA.data.national, (aes(x = Date))) +
  geom_line(aes(y = (National.Wind/1000), color = "Wind")) +
  geom_line(aes(y = (National.Renewable.total/1000), color ="Renewable")) +
  geom_segment(aes(x = as.Date("2010-02-01"), y = 20000, xend = as.Date("2010-02-01"), yend = 5500), arrow = arrow(length = unit(0.3, "cm")), color= "springgreen4", linetype = "dashed") +geom_label(aes(label="Change point 1", x=as.Date("2010-02-01"), y = 20000) , size=3, fill= "springgreen4", color = "white") +
  geom_segment(aes(x = as.Date("2014-10-01"), y = 29000, xend = as.Date("2014-10-01"), yend = 14600), arrow = arrow(length = unit(0.3, "cm")), color= "springgreen4", linetype = "dashed") +geom_label(aes(label="Change point 2", x=as.Date("2014-10-01"), y = 29000) , size=3, fill= "springgreen4", color = "white") +
  geom_segment(aes(x = as.Date("2016-09-01"), y = 35000, xend = as.Date("2016-09-01"), yend = 16450), arrow = arrow(length = unit(0.3, "cm")), color= "springgreen4", linetype = "dashed") +geom_label(aes(label="Change point 3", x=as.Date("2016-09-01"), y = 35000) , size=3, fill= "springgreen4", color = "white") +
  xlab("Date") +
  ylab("Electricity Generation (GWh)") +
  labs(title = "National Wind Electricity Generation Changepoints") +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  scale_colour_manual("Energy sources",
                      values = c("Total"="goldenrod3", 
                                 "Wind"="springgreen4",
                                 "Renewable"="yellowgreen")) 
```

```{r, echo=FALSE,fig.height = 6, fig.width = 8, fig.cap="National Wind Electricity Generation Changepoints"}
print(Plot7)
```

##B. State level trend analysis
###Trend analysis of wind energy in Kansas.

> A changepoint trend analysis was caried out for Kansas state to determine whether renewable energy from wind follows a similar trend to the national wind series

##### Kansas dataset

```{r echo=FALSE}
#Creating Kansas Dataset
data.KS.state <- EIA.data.by_state %>%
  filter(STATE=="KS") %>%
  select(Date,Wind,Renewable.total,Total)

#Converting into time series
KS.Wind <- ts(data.KS.state[,2], start = c(2001,01), end=c(2019,1),frequency = 12)
KS.renewable <- ts(data.KS.state[,3], start = c(2001,01), end=c(2019,1),frequency = 12)
KS.total <- ts(data.KS.state[,4], start = c(2001,01), end=c(2019,1),frequency = 12)
```

####Removing seasonal component out in Kansas series
```{r, echo=TRUE}
#Removing seasonal component from wind series
KS.Wind.decomp <- decompose(KS.Wind)
deseasonal_KS.Wind <- seasadj(KS.Wind.decomp)

#Removing seasonal component from the renewable energy series
KS.renewable.decomp <- decompose(KS.renewable)
deseasonal_KS.renewable <- seasadj(KS.renewable.decomp)

#Checking for a stochastic trend with ADF test
adf.test(deseasonal_KS.Wind, alternative = "stationary")
adf.test(deseasonal_KS.renewable, alternative = "stationary")
```

>The result of the ADF test of  the Wind  series (p=0.7845) indicates that the series has a stochastic trend, this result is similar for the total renewable energy series (p=0.7843).

####Changepoint analysis of wind energy series

```{r}
#analysis of first change point
pettitt.test(deseasonal_KS.Wind)
```

> small pvalues (< 2.2e-16) indicates a significant change point was detected in both series in 2009-06-01 (102) for the wind series. 

```{r}
#analysis of second change point
pettitt.test(deseasonal_KS.Wind[103:217])
```

> small p value (< 2.2e-16) indicates a significant changepoint at obs 50 (152). This changepoint occured at 2013-08-01.

```{r}
#analysis of third change point
pettitt.test(deseasonal_KS.Wind[153:217])
```

> small p value (1.17e-09) indicates a significant changepoint at obs 36 (188). This changepoint occured at 2016-08-01.

**Plot of Kansas wind changepoints**
```{r}
Plot8 <- ggplot(data = data.KS.state, (aes(x = Date))) +
  geom_line(aes(y = (Total/1000), color = "Total")) +
  geom_line(aes(y = (Wind/1000), color = "Wind")) +
  geom_line(aes(y = (Renewable.total/1000), color ="Renewable"), size = 2.5, alpha = 0.3) +
  geom_segment(aes(x = as.Date("2009-07-01"), y = 1500, xend = as.Date("2009-07-01"), yend = 200), arrow = arrow(length = unit(0.3, "cm")), color= "darkolivegreen", linetype = "dashed") +geom_label(aes(label="Change point 1", x=as.Date("2009-07-01"), y = 1500) , size=3, fill= "darkolivegreen", color = "white") +
  geom_segment(aes(x = as.Date("2013-08-01"), y = 1800, xend = as.Date("2013-08-01"), yend = 600), arrow = arrow(length = unit(0.3, "cm")), color= "darkolivegreen", linetype = "dashed") +geom_label(aes(label="Change point 2", x=as.Date("2013-08-01"), y = 1800) , size=3, fill= "darkolivegreen", color = "white") +
  geom_segment(aes(x = as.Date("2016-08-01"), y = 2400, xend = as.Date("2016-08-01"), yend = 900), arrow = arrow(length = unit(0.3, "cm")), color= "darkolivegreen", linetype = "dashed") +geom_label(aes(label="Change point 3", x=as.Date("2016-08-01"), y = 2400) , size=3, fill= "darkolivegreen", color = "white") +
  xlab("Date") +
  ylab("Electricity Generation (GWh)") +
  labs(title = "Kansas wind electricity generation") +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  scale_colour_manual("Energy sources",
                      values = c("Total"="goldenrod3", 
                                 "Wind"="springgreen4",
                                 "Renewable"="yellowgreen")) 

```

```{r, echo=FALSE,fig.height = 6, fig.width = 8, fig.cap="Kansas wind electricity generation"}
print(Plot8)
```

###Trend analysis of solar energy in California.
##### California dataset
```{r echo=FALSE}
#Creating California Dataset
data.CA.state <- EIA.data.by_state %>%
  filter(STATE=="CA") %>%
  select(Date,Solar,Renewable.total,Total)

#Converting into time series
CA.Solar <- ts(data.CA.state[,2], start = c(2001,01), end=c(2019,1),frequency = 12)
CA.renewable <- ts(data.CA.state[,3], start = c(2001,01), end=c(2019,1),frequency = 12)
CA.total <- ts(data.CA.state[,4], start = c(2001,01), end=c(2019,1),frequency = 12)
```

####Removing seasonal component out of California series
```{r, echo=TRUE}
#Removing seasonal component from solar series
CA.Solar.decomp <- decompose(CA.Solar)
deseasonal_CA.Solar <- seasadj(CA.Solar.decomp) 

#Removing seasonal component from the renewable energy series
CA.renewable.decomp <- decompose(CA.renewable)
deseasonal_CA.renewable <- seasadj(CA.renewable.decomp) 

#Checking for a stochastic trend with ADF test
adf.test(deseasonal_CA.Solar, alternative = "stationary")
adf.test(deseasonal_CA.renewable, alternative = "stationary")
```

>The result of the ADF test of  the solar  series (p=0.7322) indicates that the series has a stochastic trend. This result is similar for the total renewable energy series (p=0.2701).

####Changepoint analysis of solar energy series

```{r}
#analysis of first change point
pettitt.test(deseasonal_CA.Solar)
```

> small p value (< 2.2e-16) indicates there a change point was detected in the  solar series in observation 142 corresponding to 2012-10-01. 

```{r}
#analysis of second change point
pettitt.test(deseasonal_CA.Solar[143:217])
```

> small p value (2.106e-11) indicates there a changepoint was detected at observation 39 (181) corresponding to 2016-01-01.

```{r}
#analysis of third change point
pettitt.test(deseasonal_CA.Solar[182:217])
```

> small p value (0.00846)indicates there a changepoint was detected at observation 13 (194) corresponding to 2017-02-01.

```{r}
#analysis of fourth change point
pettitt.test(deseasonal_CA.Solar[195:217])
```

> large p value (0.6137)indicates there is no other significant changepoint. 

**Plot of California solar changepoints**
```{r}
Plot9 <- ggplot(data = data.CA.state, (aes(x = Date))) +
  geom_line(aes(y = (Total/1000), color = "Total")) +
  geom_line(aes(y = (Solar/1000), color = "Solar")) +
  geom_line(aes(y = (Renewable.total/1000), color ="Renewable")) +
  geom_segment(aes(x = as.Date("2012-10-01"), y = 2000, xend = as.Date("2012-10-01"), yend = 140), arrow = arrow(length = unit(0.2, "cm")), color= "yellow3", linetype = "dashed") +geom_label(aes(label="Change point 1", x=as.Date("2012-10-01"), y = 2000) , size=2.5, fill= "yellow3", color = "white") +
  geom_segment(aes(x = as.Date("2016-01-01"), y = 3000, xend = as.Date("2016-01-01"), yend = 800), arrow = arrow(length = unit(0.2, "cm")), color= "yellow3", linetype = "dashed") +geom_label(aes(label="Change point 2", x=as.Date("2016-01-01"), y = 3000) , size=2.5, fill= "yellow3", color = "white") +
  geom_segment(aes(x = as.Date("2017-02-01"), y = 4000, xend = as.Date("2017-02-01"), yend = 1100), arrow = arrow(length = unit(0.2, "cm")), color= "yellow3", linetype = "dashed") +geom_label(aes(label="Change point 3", x=as.Date("2017-02-01"), y = 4000) , size=2.5, fill= "yellow3", color = "white") +
  xlab("Date") +
  ylab("Electricity Generation (GWh)") +
  labs(title = "California solar electricity generation") +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  scale_colour_manual("Energy sources",
                      values = c("Total"="goldenrod3", 
                                 "Solar"="yellow3",
                                 "Renewable"="yellowgreen")) 

```

```{r, echo=FALSE,fig.height = 6, fig.width = 8, fig.cap="California solar electricity generation"}
print(Plot9)
```


\newpage

# Summary and Conclusions
<Summarize your major findings from your analyses. What conclusions do you draw from your findings? Make sure to apply this to a broader application for the research question you have answered.>

> The table below summarizes the results of the changepoint analysis tests for the electricity generation from solar energy at the national level and in California and electricity generation from wind energy at the national level and in Kansas.

Dataset                 | Changepoint 1 | Changepoint 2 |Changepoint 3 |
------------------------|---------------|-------------- |--------------|
National solar energy   | 10/2011       | 02/2015       |02/2017       |
National wind energy    | 02/2010       | 10/2014       |09/2016       |
Kansas wind energy      | 06/2009       | 08/2013       |08/2016       |
California solar energy | 10/2012       | 01/2016       |02/2017       |

> all analysed energy generation series had three changepoints. All changepoints occur post 2008 indicating the rate of adoption of renewable energy for electricity generation has changed in the last decade, consistent with the literature. All changepoints indicate also an increase in electricty generation from the renewable resource.

> Changepoint 1 and two at the national and state level do not appear to be related for both wind energy and solar. Change point 3 for solar and wind energy at the state and national level however coincide. This could indicate that significant increase in renewable energy levels is being driven by specific states and cannot neccessaritly be generalized to all.

> The changepoint 1 in Kansas wind energy series coresponds to the year the state adopted the RPS policy. Changepoint 2 does not correspond to any policy change however it is the year Kansas reached its renewable energy target of 20% of its electricity generation being from renewable resources. 

> For California, changepoint 1 and 3 does not correspond to any major renewable energy policy changes. A major policy revison however took place in 2015 and could have resulted in a shift in the solar energy trend as shown in changepoint 2. 

> It is therefore probable that polciy changes have impacted the adoption trends for wind and solar energy in Kansas and California, however more analysis needs to be done in this area to be able to definitively determine the causal relationship between policy changes and renewable energy adoption.


